<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>RO Calculator</title>
    <script src="https://unpkg.com/vue"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>

    <!-- <style type="text/css">
        #equipinput {
            display: inline;
            padding: 0 20px;
        }
    </style> -->
    <style>
        .el-row {
            margin-bottom: 4px;
        }

        .el-col {
            border-radius: 4px;
        }

        .bg-purple-dark {
            background: #99a9bf;
        }

        .bg-purple {
            background: #d3dce6;
        }

        .bg-purple-light {
            background: #e5e9f2;
        }

        .grid-content {
            border-radius: 4px;
            min-height: 36px;
        }

        .row-bg {
            padding: 10px 0;
            background-color: #f9fafc;
        }
    </style>
</head>

<body>

    <el-container style="height: 500px; border: 1px solid #eee">
        <el-header>
        </el-header>
        <el-main>
            <div id="equipment" style="width:300px; height:400px; box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1)">

                <div class="Item bg-purple-light" v-for="(item,eqindex) in equipspartlist">
                    <div class="Equipment">
                        <el-row>
                            <el-col :span="4">
                                <div>
                                    <span>{{item.id}}</span>
                                </div>
                            </el-col>
                            <el-col :span="20">
                                <div class="grid-content bg-purple-dark">
                                    <el-input v-model="equipspartlist[eqindex].equipname" placeholder="裝備名稱"></el-input>
                                </div>
                            </el-col>
                        </el-row>
                        <el-row :gutter="6">
                            <el-col :span="11">
                                <div class="grid-content bg-purple">
                                    <el-select value-key="id" v-model="equipspartlist[eqindex].EffectType"
                                        v-on:change="onSelectedDrug" placeholder="選擇效果">
                                        <el-option v-for="item in types" :key="item.id" :label="item.label"
                                            :value="item">
                                        </el-option>
                                    </el-select>
                                </div>
                            </el-col>
                            <el-col :span="8">
                                <div class="grid-content bg-purple-light">
                                    <el-input v-model="equipspartlist[eqindex].EffectNumber"
                                        v-on:keyup.enter.native="AddEffect(eqindex)" placeholder="效果參數">
                                    </el-input>
                                </div>
                            </el-col>
                            <el-col :span="5">
                                <div>
                                    <el-button v-on:click="AddEffect(eqindex)" icon="el-icon-circle-plus-outline"
                                        type="success" plain>
                                    </el-button>
                                </div>
                            </el-col>
                        </el-row>
                        <el-row>
                            <el-col :span="24">
                                <el-row>
                                    <div class="Item bg-purple-light"
                                        v-for="(item, index) in equipspartlist[eqindex].effectlist"
                                        v-bind:key="item.types">
                                        <el-row class="grid-content bg-purple-light" :gutter="6">
                                            <el-col :span="11" justify="center">
                                                <span class="EffectType">{{ item.EffectType.label }}</span>
                                            </el-col>
                                            <el-col :span="8" justify="center">
                                                <span class="EffectNumber">{{ item.EffectNumber }}</span>
                                            </el-col>
                                            <el-col :span="5" justify="center">
                                                <el-button v-on:click="RemoveEffect(eqindex, index)"
                                                    icon="el-icon-remove-outline" type="success" plain></el-button>
                                            </el-col>
                                        </el-row>
                                    </div>
                                </el-row>
                            </el-col>
                        </el-row>
                    </div>
                </div>
            </div>
        </el-main>
        <el-footer>
        </el-footer>
    </el-container>



    <script>
        evue = new Vue({
            el: '#equipment',
            data: {
                equipname: '',
                contacts: [],
                equipspartlist: [
                    { id: 'helm', equipname: '', effectlist: [], EffectType: '', EffectNumber: '' },
                    { id: 'armor', equipname: '', effectlist: [], EffectType: '', EffectNumber: '' },
                    { id: 'weaponl', equipname: '', effectlist: [], EffectType: '', EffectNumber: '' },
                    { id: 'weaponr', equipname: '', effectlist: [], EffectType: '', EffectNumber: '' },
                    { id: 'robe', equipname: '', effectlist: [], EffectType: '', EffectNumber: '' },
                    { id: 'shoes', equipname: '', effectlist: [], EffectType: '', EffectNumber: '' },
                    { id: 'ass1', equipname: '', effectlist: [], EffectType: '', EffectNumber: '' },
                    { id: 'ass2', equipname: '', effectlist: [], EffectType: '', EffectNumber: '' },
                ],
                types: [
                    { label: 'ATK', id: 'ATK' },
                    { label: 'ATK%', id: 'ATKPercent' },
                    { label: 'Matk', id: 'Matk' },
                    { label: 'Matk%', id: 'MatkPercent' }
                ],
                input: {
                    EffectType: '',
                    EffectNumber: ''
                }
            },
            methods: {
                AddEffect(eqindex) {
                    if( this.equipspartlist[eqindex].EffectNumber === '' ) { return; }

                    if (this.equipspartlist[eqindex].effectlist.length > 0) {
                        var index = this.equipspartlist[eqindex].effectlist.findIndex(x => this.equipspartlist[eqindex].EffectType.label === x.EffectType.label);

                        if (index > -1) {
                            this.equipspartlist[eqindex].effectlist[index] = {
                                EffectNumber: this.equipspartlist[eqindex].EffectNumber,
                                EffectType: this.equipspartlist[eqindex].EffectType
                            };
                            console.log("CoverEffect: " + this.equipspartlist[eqindex].effectlist[index].EffectType + " /" + this.equipspartlist[eqindex].effectlist[index].EffectNumber);

                            this.$set(this.equipspartlist[eqindex].effectlist,
                                index,
                                {
                                    EffectNumber: this.equipspartlist[eqindex].effectlist[index].EffectNumber,
                                    EffectType: this.equipspartlist[eqindex].effectlist[index].EffectType
                                })
                            this.equipspartlist[eqindex].EffectNumber = '';
                            return;
                        }
                    }
                    this.equipspartlist[eqindex].effectlist.push({
                        EffectNumber: this.equipspartlist[eqindex].EffectNumber,
                        EffectType: this.equipspartlist[eqindex].EffectType,
                    })
                    console.log("AddEffect: " + this.equipspartlist[eqindex].EffectType + " /" + this.equipspartlist[eqindex].EffectNumber);
                    this.equipspartlist[eqindex].EffectNumber = '';
                },
                RemoveEffect(eqindex, index) {
                    console.log("RemoveEffect: [" + eqindex + "] " + index);
                    //var index = this.equipspartlist[eqindex].indexOf(item)
                    if (index >= 0) {
                        this.equipspartlist[eqindex].effectlist.splice(index, 1)
                    }
                },
                onSelectedDrug(item) {
                    console.log("onSelectedDrug " + item.label);
                },
            },
            mounted() {
                console.log("mounted");
                for (i = 0; i < this.equipspartlist.length; i++) 
                {
                    this.equipspartlist[i].EffectType = this.types[0];
                }
            }
        })
    </script>

    <body>

</html>